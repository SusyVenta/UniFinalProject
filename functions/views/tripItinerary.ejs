<!DOCTYPE html>
<html lang="en">

<head>
  <!-- SHARED HEAD -->
  <%- include('partials/sharedHead') %>

  <!-- Title tag in the browser and Google results -->
  <title>GroupTripper | Your trips</title>
  <meta property="og:title" content="GroupTripper: best free group trip planner app - your trips" data-rh="true">
  <meta property="twitter:title" content="GroupTripper: best free group trip planner app - your trips" data-rh="true">
  <meta name="description" content="Plan your group vacation or trip with the best online travel planner app. Create itineraries faster as a group by sharing suggestions, creating polls, and voting with your friends." data-rh="true">
  <meta property="og:description" content="Plan your group vacation or trip with the best online travel planner app. Create itineraries faster as a group by sharing suggestions, creating polls, and voting with your friends." data-rh="true">
  <meta name="twitter:description" content="Plan your group vacation or trip with the best online travel planner app. Create itineraries faster as a group by sharing suggestions, creating polls, and voting with your friends." data-rh="true">
  <meta property="og:image:alt" content="Screenshot of GroupTripper: one view for your map and itinerary" data-rh="true">

  <!-- css -->
  <link rel="stylesheet" href="/css/generic.css">
  <link rel="stylesheet" href="/css/footer.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link rel="stylesheet" href="/css/tripCommon.css">
  <link rel="stylesheet" href="/css/tripItinerary.css">

  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <!-- https://www.daterangepicker.com/ -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

  <!-- Tom Select -->
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
  <script src="/js/tripCommon.js"></script>
  <script src="/js/tripItinerary.js"></script>
</head>

<body>
  <div>
    <%- include('partials/header'); %>
  </div>
  <div class="outer-container">
    <div class="title-container"
      style="background-image: url('<%= trip.picture.src.landscape %>');"
      alt="'<%= trip.picture.alt %>' by <%= trip.picture.photographer %>" src="<%= trip.picture.src.medium %>">
      <div id="title-inner-container">
        <h1 id="title"><%= trip.tripTitle %></h1>
        <% if (trip.participantsStatus[userID] !== 'pending') { %>
          <button id="edit-trip-title-button" class="btn btn-secondary" onclick="alterTripTitle('<%= tripID %>');">
            <i id="edit-trip-title-button-icon" class="fas fa-pencil"></i>
          </button>
        <%} %>
      </div>
    </div>

    <div class="trip-tab" id="trip-<%= trip.tripID %>" >
      <!-- tab names -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" href="/trips/<%= trip.tripID %>/participants" >Participants</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/trips/<%= trip.tripID %>/itinerary" >Itinerary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/trips/<%= trip.tripID %>/polls" >Polls</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/trips/<%= trip.tripID %>/settings" >Settings</a>
        </li>
      </ul>
      <!-- tab content -->
      <div class="tab-content">
        <!-- friendship types -->
        <% var friendshipsUIDs = profileDetails.friends; %>
        <% var friendshipsAccepted = []; %>
        <% Object.keys(friendshipsUIDs).forEach(function(friendUid) { %>
          <% if (friendshipsUIDs[friendUid] === 'friends') { %>
            <% friendshipsAccepted.push(friendUid) %>
          <% } %>
        <% }); %>
        <!-- ---------------------------- itinerary ------------------------->
        <div id="itinerary-tab" class="tab-pane active">
          <div id="finalized-dates">
            <% if (trip.finalizedEndDate === null) { %>
              <p>Final dates not chosen yet</p>
            <%} else { %>
              <p>Chosen dates: <%= trip.finalizedStartDate %> - <%= trip.finalizedEndDate %></p>
            <%} %>
          </div>
          <div>
            <button class="btn btn-secondary" onclick="showAddEventModal('<%= JSON.stringify(trip.participantsStatus) %>', '<%= JSON.stringify(friendsProfiles) %>', '<%= userID %>');">Add event</button>
          </div>
          <div id="events-container">

          </div>
        </div>
      </div>
    </div>
  </div>

  <section>
    <!-- modal displaying form to add new trip event-->
    <div id="new-event-modal" class="modal" tabindex="-1" data-bs-backdrop="static">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title" id="new-event-modal-title">New Event</h1>
            <button type="button" id="new-event-modal-close-button" class="btn-close" onclick="$('#new-event-modal').hide();" aria-label="Close"></button>
          </div>
          <div class="modal-body">

            <!-- dropdown event type -->
            <label for="event-type" class="form-label">Event type: </label>
            <div class="dropdown event-type" id="event-type-container">
              <button 
                  class="btn btn-secondary dropdown-toggle" 
                  type="button" id="event-type" 
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Choose event type
              </button>
              <ul class="dropdown-menu date-collection-type" aria-labelledby="event-type">
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-city"
                    onclick="document.getElementById('event-type').innerHTML = 'City';">City</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-accommodation"
                    onclick="document.getElementById('event-type').innerHTML = 'Accommodation';">Accommodation</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-transportation"
                    onclick="document.getElementById('event-type').innerHTML = 'Transportation';">Transportation</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-attraction"
                    onclick="document.getElementById('event-type').innerHTML = 'Attraction / Event';">Attraction / Event</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-food"
                    onclick="document.getElementById('event-type').innerHTML = 'Food & Drinks';">Food & Drinks</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" id="event-type-option-todo"
                    onclick="document.getElementById('event-type').innerHTML = 'Task to do';">Task to do</button>
                </li>
              </ul>
            </div>

            <!-- name / description -->
            <label for="new-event-title" class="form-label">Name / Description</label>
            <input autocomplete="one-time-code" class="form-control" id="new-event-title" required=true >

            <!-- start and end datetimes -->
            <div id="date-availabilities-container">
              <div id="date-availability-1" class="date-availability-container">
                <div class="event-dates-container">
                  <div class="label-and-input-container-start-date">
                    <p >Start datetime:</p>
                    <div class="form-control" >
                      <i class="fa fa-calendar"></i>
                      <input class="form-control" id="new-event-availability-start" type="text" name="daterange"/>
                    </div>
                  </div>
                  <div class="label-and-input-container-end-date">
                    <p >End datetime:</p>
                    <div class="form-control" >
                      <i class="fa fa-calendar"></i>
                      <input class="form-control" id="new-event-availability-end" type="text" name="daterange"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- address -->
            <label for="new-event-address" class="form-label">Address</label>
            <input autocomplete="one-time-code" class="form-control" id="new-event-address" required=false >

            <!-- description & notes -->
            <label for="new-event-address" class="form-label">Description & Notes</label>
            <textarea autocomplete="one-time-code" class="form-control" id="new-event-description" required=false ></textarea>

            <!-- add friends to event -->
            <label for="new-trip-event-multiselect-friends" class="form-label">Participants: </label>
            <select id="new-trip-event-multiselect-friends" multiple placeholder="">
            </select>

            <!-- ask participants if they will join -->
            <input  class="form-check-input" type="checkbox" id="new-event-ask-participation-confirmation">
            <label for="new-event-ask-participation-confirmation">Ask participants if they will join</label><br><br>

            <!-- dropdown event type -->
            <div class="dropdown event-type" id="event-status-container">
              <label for="event-status" class="form-label">Event status: </label>
              <button 
                  class="btn btn-secondary dropdown-toggle" 
                  type="button" id="event-status" 
                  data-bs-toggle="dropdown" aria-expanded="false">
                  to book
              </button>
              <ul class="dropdown-menu" aria-labelledby="event-type">
                <li>
                  <button class="dropdown-item event-type"
                    onclick="document.getElementById('event-status').innerHTML = 'to book';">to book</button>
                </li>
                <li>
                  <button class="dropdown-item event-type"
                    onclick="document.getElementById('event-status').innerHTML = 'booked';">booked</button>
                </li>
                <li>
                  <button class="dropdown-item event-type" 
                    onclick="document.getElementById('event-status').innerHTML = 'awaiting votes';">awaiting votes</button>
                </li>
              </ul>
            </div>

          </div>
          <div class="modal-footer" id="new-event-modal-footer">
            <button id="new-event-cancel-button" type="button" class="btn btn-secondary" onclick="$('#new-event-modal').hide();">Cancel</button>
            <button id="new-event-create-button" type="submit" class="btn btn-secondary" onclick="saveEvent('<%= trip.tripID %>');">Save</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- date pickers listeners --------------------------------------------------------------------->
  <script>
    $(function() {
      $('#new-event-availability-start').daterangepicker({
        timePicker: true,
        singleDatePicker: true,
        opens: 'left',
        minYear: moment().year(),
        startDate: moment().startOf('hour'),
        locale: {
          format: 'DD/MM/YYYY hh:mm A'
        }
      });
    });
    $(`#new-event-availability-start`).on('apply.daterangepicker', function(event, picker) {
      let newValue = picker.startDate.format('DD/MM/YYYY hh:mm A');

      document.getElementById("new-event-availability-start").value = newValue;
    });

    $(function() {
      $('#new-event-availability-end').daterangepicker({
        timePicker: true,
        singleDatePicker: true,
        opens: 'left',
        minYear: moment().year(),
        startDate: moment().startOf('hour'),
        locale: {
          format: 'DD/MM/YYYY hh:mm A'
        }
      });
    });
    $(`#new-event-availability-end`).on('apply.daterangepicker', function(event, picker) {
      let newValue = picker.startDate.format('DD/MM/YYYY hh:mm A');

      document.getElementById("new-event-availability-end").value = newValue;
    });
  </script>

  <!-- trip event listeners -->
  <script>
    // get live notifications
    let tripID = '<%= trip.tripID %>'; 
    getTripEvents(tripID);
  </script>
  
  <%- include('partials/footer'); %>
</body>

</html>